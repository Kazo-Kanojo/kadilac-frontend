<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Ficha de Veículo</title>
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="recibo-a4 ficha-veiculo">
        <header class="doc-header">
            <h1 style="text-transform: uppercase;">{{LOJA_NOME}}</h1>
            <p class="separador">***</p>
            <h2>FICHA DE VEÍCULO</h2>
            <p class="separador">***</p>
        </header>

        <div class="datas-entrada-saida">
            <p><strong>Emissão:</strong> {{DATA_ATUAL}}</p>
        </div>

        <main>
            <section class="info-principal-veiculo">
                <div class="field-group" style="flex-basis: 100%;">
                    <div class="field" style="flex-basis: 60%;"><label>Veículo:</label><span>{{VEICULO_MARCA}} {{VEICULO_MODELO}}</span></div>
                    <div class="field" style="flex-basis: 35%;"><label>Placa:</label><span>{{VEICULO_PLACA}}</span></div>
                </div>
                
                <div class="field-group" style="flex-basis: 100%;">
                    <div class="field"><label>Ano:</label><span>{{VEICULO_ANO}}</span></div>
                    <div class="field"><label>Cor:</label><span>{{VEICULO_COR}}</span></div>
                    <div class="field"><label>Combustível:</label><span>Flex</span></div>
                </div>

                <div class="field-group">
                    <div class="field full"><label>Chassi:</label><span>{{VEICULO_CHASSI}}</span></div>
                    <div class="field full"><label>Renavam:</label><span>{{VEICULO_RENAVAM}}</span></div>
                    <div class="field full"><label>Certificado:</label><span>{{VEICULO_CERTIFICADO}}</span></div>
                </div>
            </section>

            <hr>

            <section class="info-cliente-interessado">
                <h3>Dados do Cliente / Interessado</h3>
                <div class="field-group">
                    <div class="field full"><label>Nome:</label><span>{{CLIENTE_NOME}}</span></div>
                    <div class="field full"><label>CPF:</label><span>{{CLIENTE_CPF}}</span></div>
                    <div class="field full"><label>Telefone:</label><span>{{CLIENTE_TELEFONE}}</span></div>
                </div>
            </section>
            
            <section class="resumo-financeiro">
                <h3>Proposta / Valores</h3>
                <div class="resumo-linha">
                    <span>Valor de Venda:</span>
                    <strong>{{VEICULO_PRECO}}</strong>
                </div>
                <div class="resumo-linha">
                    <span>Vendedor:</span>
                    <strong>{{VENDEDOR_NOME}}</strong>
                </div>
            </section>
        </main>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            const data = JSON.parse(localStorage.getItem('sistema_print_data'));
            if (!data) return;
            const formatMoney = (val) => val ? parseFloat(val).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }) : '';

            const replacements = {
                '{{CLIENTE_NOME}}': data.client?.nome || '',
                '{{CLIENTE_CPF}}': data.client?.cpf_cnpj || '',
                '{{CLIENTE_TELEFONE}}': data.client?.telefone || '',
                '{{VEICULO_MODELO}}': data.vehicle?.modelo || '',
                '{{VEICULO_MARCA}}': data.vehicle?.marca || '',
                '{{VEICULO_PLACA}}': data.vehicle?.placa || '',
                '{{VEICULO_COR}}': data.vehicle?.cor || '',
                '{{VEICULO_ANO}}': data.vehicle?.ano || '',
                '{{VEICULO_RENAVAM}}': data.vehicle?.renavam || '',
                '{{VEICULO_CHASSI}}': data.vehicle?.chassi || '',
                '{{VEICULO_CERTIFICADO}}': data.vehicle?.certificado || '',
                '{{VEICULO_PRECO}}': formatMoney(data.sale?.price),
                '{{VENDEDOR_NOME}}': data.sale?.seller || '',
                '{{LOJA_NOME}}': data.store?.nome_loja || 'LOJA',
                '{{DATA_ATUAL}}': data.date
            };

            let html = document.body.innerHTML;
            for (const [key, val] of Object.entries(replacements)) {
                html = html.replace(new RegExp(key, 'g'), val);
            }
            document.body.innerHTML = html;
            setTimeout(() => window.print(), 500);
        });
    </script>
</body>
</html>